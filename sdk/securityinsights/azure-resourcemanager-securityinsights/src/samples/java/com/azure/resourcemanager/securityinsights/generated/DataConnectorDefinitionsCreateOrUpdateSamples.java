// Copyright (c) Microsoft Corporation. All rights reserved.
// Licensed under the MIT License.
// Code generated by Microsoft (R) AutoRest Code Generator.

package com.azure.resourcemanager.securityinsights.generated;

import com.azure.core.management.serializer.SerializerFactory;
import com.azure.core.util.serializer.SerializerEncoding;
import com.azure.resourcemanager.securityinsights.models.ConnectivityCriterion;
import com.azure.resourcemanager.securityinsights.models.ConnectorDataType;
import com.azure.resourcemanager.securityinsights.models.ConnectorDefinitionsAvailability;
import com.azure.resourcemanager.securityinsights.models.ConnectorDefinitionsPermissions;
import com.azure.resourcemanager.securityinsights.models.ConnectorDefinitionsResourceProvider;
import com.azure.resourcemanager.securityinsights.models.CustomPermissionDetails;
import com.azure.resourcemanager.securityinsights.models.CustomizableConnectorDefinition;
import com.azure.resourcemanager.securityinsights.models.CustomizableConnectorUiConfig;
import com.azure.resourcemanager.securityinsights.models.GraphQuery;
import com.azure.resourcemanager.securityinsights.models.InstructionStep;
import com.azure.resourcemanager.securityinsights.models.InstructionStepDetails;
import com.azure.resourcemanager.securityinsights.models.ProviderPermissionsScope;
import com.azure.resourcemanager.securityinsights.models.ResourceProviderRequiredPermissions;
import com.azure.resourcemanager.securityinsights.models.SampleQuery;
import java.io.IOException;
import java.util.Arrays;

/** Samples for DataConnectorDefinitions CreateOrUpdate. */
public final class DataConnectorDefinitionsCreateOrUpdateSamples {
    /*
     * x-ms-original-file: specification/securityinsights/resource-manager/Microsoft.SecurityInsights/preview/2023-10-01-preview/examples/dataConnectorDefinitions/CreateCustomizableDataConnectorDefinition.json
     */
    /**
     * Sample code: Create data connector definition.
     *
     * @param manager Entry point to SecurityInsightsManager.
     */
    public static void createDataConnectorDefinition(
        com.azure.resourcemanager.securityinsights.SecurityInsightsManager manager) throws IOException {
        manager
            .dataConnectorDefinitions()
            .createOrUpdateWithResponse(
                "myRg",
                "myWorkspace",
                "73e01a99-5cd7-4139-a149-9f2736ff2ab5",
                new CustomizableConnectorDefinition()
                    .withEtag("\"0300bf09-0000-0000-0000-5c37296e0000\"")
                    .withConnectorUiConfig(
                        new CustomizableConnectorUiConfig()
                            .withTitle("GitHub Enterprise Audit Log")
                            .withPublisher("GitHub")
                            .withDescriptionMarkdown(
                                "The GitHub audit log connector provides the capability to ingest GitHub logs into"
                                    + " Azure Sentinel. By connecting GitHub audit logs into Azure Sentinel, you can"
                                    + " view this data in workbooks, use it to create custom alerts, and improve your"
                                    + " investigation process.")
                            .withGraphQueries(
                                Arrays
                                    .asList(
                                        new GraphQuery()
                                            .withMetricName("Total events received")
                                            .withLegend("GitHub audit log events")
                                            .withBaseQuery("GitHubAuditLogPolling_CL")))
                            .withSampleQueries(
                                Arrays
                                    .asList(
                                        new SampleQuery()
                                            .withDescription("All logs")
                                            .withQuery("GitHubAuditLogPolling_CL \n | take 10")))
                            .withDataTypes(
                                Arrays
                                    .asList(
                                        new ConnectorDataType()
                                            .withName("GitHubAuditLogPolling_CL")
                                            .withLastDataReceivedQuery(
                                                "GitHubAuditLogPolling_CL \n"
                                                    + "            | summarize Time = max(TimeGenerated)\n"
                                                    + "            | where isnotempty(Time)")))
                            .withConnectivityCriteria(
                                Arrays
                                    .asList(
                                        new ConnectivityCriterion()
                                            .withType("IsConnectedQuery")
                                            .withValue(
                                                Arrays
                                                    .asList(
                                                        "GitHubAuditLogPolling_CL \n"
                                                            + " | summarize LastLogReceived = max(TimeGenerated)\n"
                                                            + " | project IsConnected = LastLogReceived > ago(30d)"))))
                            .withAvailability(new ConnectorDefinitionsAvailability().withStatus(1).withIsPreview(false))
                            .withPermissions(
                                new ConnectorDefinitionsPermissions()
                                    .withResourceProvider(
                                        Arrays
                                            .asList(
                                                new ConnectorDefinitionsResourceProvider()
                                                    .withProvider("Microsoft.OperationalInsights/workspaces")
                                                    .withPermissionsDisplayText(
                                                        "read and write permissions are required.")
                                                    .withProviderDisplayName("Workspace")
                                                    .withScope(ProviderPermissionsScope.WORKSPACE)
                                                    .withRequiredPermissions(
                                                        new ResourceProviderRequiredPermissions()
                                                            .withRead(false)
                                                            .withWrite(true)
                                                            .withDelete(false)
                                                            .withAction(false))))
                                    .withCustoms(
                                        Arrays
                                            .asList(
                                                new CustomPermissionDetails()
                                                    .withName("GitHub API personal token Key")
                                                    .withDescription(
                                                        "You need access to GitHub personal token, the key should have"
                                                            + " 'admin:org' scope"))))
                            .withInstructionSteps(
                                Arrays
                                    .asList(
                                        new InstructionStep()
                                            .withTitle("Connect GitHub Enterprise Audit Log to Azure Sentinel")
                                            .withDescription(
                                                "Enable GitHub audit Logs. \n"
                                                    + " Follow"
                                                    + " [this](https://docs.github.com/en/github/authenticating-to-github/keeping-your-account-and-data-secure/creating-a-personal-access-token)"
                                                    + " to create or find your personal key")
                                            .withInstructions(
                                                Arrays
                                                    .asList(
                                                        new InstructionStepDetails()
                                                            .withParameters(
                                                                SerializerFactory
                                                                    .createDefaultManagementSerializerAdapter()
                                                                    .deserialize(
                                                                        "{\"clientIdLabel\":\"Client"
                                                                            + " ID\",\"clientSecretLabel\":\"Client"
                                                                            + " Secret\",\"connectButtonLabel\":\"Connect\",\"disconnectButtonLabel\":\"Disconnect\"}",
                                                                        Object.class,
                                                                        SerializerEncoding.JSON))
                                                            .withType("OAuthForm")))))),
                com.azure.core.util.Context.NONE);
    }
}
